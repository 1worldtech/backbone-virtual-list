define(["backbone","lodash"],function(t,e){return function(t){function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return t[s].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var s;s=function(t,e,s){i(1),i(5),s.exports=i(7)}.call(e,i,e,t),!(void 0!==s&&(t.exports=s))},function(t,e){},,,,function(t,e){},,function(t,e,i){var s=i(8),n=i(9).debounce;t.exports=s.View.extend({itemHeight:30,listHeight:300,itemView:null,events:{scroll:"updateItems"},initialize:function(){this._lastStartIndex=0,this._dict={},this.removeItemsDebounced=n(this.removeItems,300),this.listenTo(this.collection,"remove",this.syncRemovedItem),this.listenTo(this.collection,"add",this.syncAddedItem)},render:function(){return this.$el.addClass("virtual-list").html(this.getScroller()),this.updateItems(),this},getScroller:function(){var t=document.createElement("div");return t.className="virtual-list__scroller",t.style.height=this.collection.length*this.itemHeight+"px",t},updateScroller:function(){this.$(".virtual-list__scroller").css("height",this.collection.length*this.itemHeight)},updateItemHeight:function(t){this.itemHeight=t,this.updateScroller();var e=this._dict;for(var i in e)e[i]&&(e[i].__virtualListHidden=!0);this.updateItems(),this.removeItems()},updateItems:function(){var t=Math.max(0,Math.floor(this.el.scrollTop/this.itemHeight)-3),e=Math.floor(this.listHeight/this.itemHeight)+6,i=Math.min(this.collection.length,t+e);this.hideItems(t,e),this.showItems(t,i),this.removeItemsDebounced()},getHiddenIndexes:function(t,e){return t<this._lastStartIndex?[t+e,this._lastStartIndex+e]:[this._lastStartIndex,t]},hideItems:function(t,e){var i=this.getHiddenIndexes(t,e);if(i[0]!==i[1])for(var s=i[0];s<=i[1];s++){var n=this.collection.at(s);if("undefined"!=typeof n){var o=this._dict[n.cid];o&&(o.__virtualListHidden=!0)}}this._lastStartIndex=t},getView:function(t){var e=this._dict[this.collection.at(t).cid];return e?(e.__virtualListHidden=!1,e):this.getNewView(t)},getNewView:function(t){var e=new this.itemView({model:this.collection.models[t]});return this._dict[this.collection.at(t).cid]=e,e.render(),e},showItems:function(t,e){for(var i=[],s=t;s<e;s++){var n=this.getView(s);n.$el.css({position:"absolute",top:s*this.itemHeight}).addClass("virtual-list__item"),i.push(n.el)}var o=document.createDocumentFragment();for(s=0;s<i.length;s++)o.appendChild(i[s]);this.el.appendChild(o)},removeItems:function(){var t=this._dict;for(var e in t)t[e]&&t[e].__virtualListHidden&&(t[e].remove(),t[e]=null)},syncRemovedItem:function(t){this._dict[t.cid].__virtualListHidden=!0,this.updateScroller(),this.removeItems(),this.updateItems()},syncAddedItem:function(){this.updateScroller(),this.updateItems()}})},function(e,i){e.exports=t},function(t,i){t.exports=e}])});